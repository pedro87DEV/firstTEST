var payload,merkle,siblings,siblings_1,siblings_2,notarization,CheckCert=CheckCert||function(){var o,a,f,s,v,m,c,t={};function p(t){this.index=-1,this.string=t}function y(t){for(var e="",n=0;n<t.length;n++)e+=""+t.charCodeAt(n).toString(16);return e}function r(t,e,n){var r=t.target.files[0];c=r.name;var i=new FileReader;i.onload=function(t){(o=PDFJS.getDocument(t.target.result)).then(function(t){return t.pdfInfo.numPages},function(){return"PDFStructureNotValidFault"}).then(e,n)},i.readAsDataURL(r)}return p.prototype.getChar=function(){return this.index++,this.index===this.string.length?null:this.string.charAt(this.index)},p.prototype.getToken=function(){for(var t="",e=!1,n="",r=0;null!==n&&!e;)"{"===(n=this.getChar())?(r++,t+=n):0<r&&"}"!==n?t+=n:0<r&&"}"===n&&(t+=n,0===--r&&(e=!0));return e?t:null},t.getPDFName=function(){return c},t.restoreData=function(t){var e;t==a?e=payload:t==s?e=notarization:t==f?e=merkle:t==v?e=siblings_1:t==m&&(e=siblings_2);for(var n=document.getElementById(t),r="",i=0;i<e.length;i++)r=e.charAt(i)==String.fromCharCode(247)?r.concat(" "):r.concat(e.charAt(i));n.value=r},t.resetAllData=function(t,e,n,r,i){for(var o in siblings_2=siblings_1=merkle=notarization=payload=null,arguments)$("#"+arguments[o]).val("")},t.extractData=function(t,c,l,u,h,d,g){var r;a=c,s=l,f=u,v=h,m=d,(r=t,o.then(function(t){var e=[],n=t.getPage(parseInt(r));return e.push(n.then(function(t){return t.getTextContent().then(function(t){return t.items.map(function(t){return t.str}).join("")})})),Promise.all(e).then(function(t){return t.join("")})})).then(function(t){var e=new p(t),n=0,r=c,i=e.getToken();for(payload=i;null!==i;){1===n&&(r=l,notarization=i),2===n&&(r=u,merkle=i),3===n&&(r=h,siblings_1=siblings=i),4===n&&i.includes("siblings_")?(r=d,siblings+=i,siblings_2=i):4===n&&n++;for(var o=document.getElementById(r),a="",s=0;s<i.length;s++)a=i.charAt(s)==String.fromCharCode(247)?a.concat(" "):a.concat(i.charAt(s));o.value=a,i=e.getToken(),n++}g()},function(t){console.error(t)})},t.loadDocument=function(t,e,n){document.getElementById(t).addEventListener("change",function(t){r(t,e,n)},!1)},t.showDocument=function(e,a,s,c){if(o)return o.then(function(t){t.getPage(parseInt(e)).then(function(t){var e=document.getElementById(a),n=e.getContext("2d");e.height=c,e.width=s;var r=t.getViewport(1),i=Math.min(e.height/r.height,e.width/r.width),o={canvasContext:n,viewport:t.getViewport(i)};t.render(o)})})},t.verifyBC=function(c,l){try{var u,t,h=JSON.parse(document.getElementById(s).value),d=JSON.parse(document.getElementById(f).value),g=new XMLHttpRequest;if("Bitcoin-mainnet"===h.blockchain)t="https://blockexplorer.com/api/tx/";else{if("Bitcoin-regtest"===h.blockchain)return void c({success:!1,errorCode:5,env:h.blockchain});if("Bitcoin-testnet"!==h.blockchain)return void c({success:!1,errorCode:5,env:h.blockchain});t="https://testnet.blockexplorer.com/api/tx/"}g.onreadystatechange=function(){if(4===g.readyState)if(200===g.status){var t=JSON.parse(g.responseText),e=!1,n=!1,r=!1;t.txid===h.transactionId&&(e=!0);for(var i=0;i<t.vout.length;i++){var o=t.vout[i],a=(o.scriptPubKey.hex,o.scriptPubKey.asm);if(a.startsWith("OP_RETURN ")){var s=y(d.merkle.root);if(a.substring(12,140)===s){n=!0;break}}}"CONFIRMED"===h.status&&6<=t.confirmations?r=!0:"PENDING"===h.status&&0<=t.confirmations&&t.confirmations<6&&(r=!0),u=e&&n&&r?{success:!0,txId:t.txid,env:h.blockchain}:e?n?r?{success:!1,errorCode:4,txId:t.txid,env:h.blockchain}:{success:!1,errorCode:3,txId:t.txid,env:h.blockchain}:{success:!1,errorCode:1,txId:t.txid,env:h.blockchain}:{success:!1,errorCode:0,txId:t.txid,env:h.blockchain},c(u)}else l(g.status)},g.open("GET",t+h.transactionId),g.send()}catch(t){c({success:!1,errorCode:6})}},t.verifyHash=function(e){try{var t=JSON.parse(document.getElementById(f).value);$.isEmptyObject(t)&&!t.hasOwnProperty("merkle")?e(!1):e(CryptoJS.SHA256(document.getElementById(a).value).toString(CryptoJS.enc.Hex)===t.merkle.hash)}catch(t){e(!1)}},t.verifyMerkle=function(e){try{var t=JSON.parse(document.getElementById(f).value);if($.isEmptyObject(t)&&!t.hasOwnProperty("merkle"))return void e(!1);var n=t.merkle.index,r=[],i=JSON.parse(document.getElementById(v).value),o=JSON.parse(document.getElementById(m).value);if(i&&null!=i.siblings_1)for(var a=0;a<i.siblings_1.length;a++)r.push(i.siblings_1[a]);if(o&&null!==o.siblings_2)for(a=0;a<o.siblings_2.length;a++)r.push(o.siblings_2[a]);var s=t.merkle.hash;if(0===r.length){l=s+s;var c=CryptoJS.enc.Hex.parse(l);s=CryptoJS.SHA256(CryptoJS.SHA256(c)).toString(CryptoJS.enc.Hex)}else for(a=0;a<r.length;a++){var l,u=r[a];l=n%2==0?s+u:u+s;c=CryptoJS.enc.Hex.parse(l);s=CryptoJS.SHA256(CryptoJS.SHA256(c)).toString(CryptoJS.enc.Hex),n>>=1}e(s.match(/.{1,2}/g).reverse().join("")===t.merkle.root)}catch(t){e(!1)}},t}();
</script>
    <script type="text/javascript">
var allRequestLibrariesAreNotLoadedMsg="Le librerie necessarie per il completo funzionamento della pagina non sono state caricate correttamente.",blockchainValidMsg="Blocktime, numero di conferme e merkle root corrispondono ai dati della transazione ${txId} presente sulla blockchain di ${env}",transactionIdErrorMsg="Il transaction id non corrisponde a quello della transazione ${txId} presente sulla blockchain di ${env}",blocktimeErrorMsg="Il blocktime non corrisponde a quello della transazione ${txId} presente sulla blockchain di ${env}",merkleRootErrorMsg="Il merkle root non corrisponde a quello della transazione ${txId} presente sulla blockchain di ${env}",confirmationsErrorMsg="Il numero di conferme non corrisponde a quello della transazione ${txId} presente sulla blockchain di ${env}",dataInsertedErrorMsg="I dati inseriti non corrispondono a quelli della transazione ${txId} presente sulla blockchain di ${env}",dataFormattedErrorMsg="I dati inseriti non sono corretti",environmentErrorMsg="Non è prevista la verifica su ambiente ${env}",requestDataNotValidMsg="Errore ${code}: è possibile che i dati della richiesta non siano validi",connectionErrorMsg="Problema di connessione con il servizio, ritentare",transactionNotFound="La transazione che stai cercando non esiste",hashValidMsg="Il testo notarizzato corrisponde al campo hash nel box merkle tree",hashNotValidMsg="Il testo notarizzato non corrisponde al campo hash nel box merkle tree",merkleValidMsg="Il merkle root corrisponde alla combinazione di hash e siblings",merkleNotValidMsg="Il merkle root corrisponde alla combinazione di hash e siblings";
var allRequestLibrariesAreNotLoadedMsg="Le librerie necessarie per il completo funzionamento della pagina non sono state caricate correttamente.",blockchainValidMsg="Numero di conferme e merkle root corrispondono ai dati della transazione ${txId} presente sulla blockchain di ${env}",transactionIdErrorMsg="Il transaction id non corrisponde a quello della transazione ${txId} presente sulla blockchain di ${env}",blocktimeErrorMsg="Il blocktime non corrisponde a quello della transazione ${txId} presente sulla blockchain di ${env}",merkleRootErrorMsg="Il merkle root non corrisponde a quello della transazione ${txId} presente sulla blockchain di ${env}",confirmationsErrorMsg="Il numero di conferme non corrisponde a quello della transazione ${txId} presente sulla blockchain di ${env}",dataInsertedErrorMsg="I dati inseriti non corrispondono a quelli della transazione ${txId} presente sulla blockchain di ${env}",dataFormattedErrorMsg="I dati inseriti non sono corretti",environmentErrorMsg="Non è prevista la verifica su ambiente ${env}",requestDataNotValidMsg="Errore ${code}: è possibile che i dati della richiesta non siano validi",connectionErrorMsg="Problema di connessione con il servizio, ritentare",transactionNotFound="La transazione che stai cercando non esiste",hashValidMsg="Il testo notarizzato corrisponde al campo hash nel box merkle tree",hashNotValidMsg="Il testo notarizzato non corrisponde al campo hash nel box merkle tree",merkleValidMsg="Il merkle root corrisponde alla combinazione di hash e siblings",merkleNotValidMsg="Il merkle root corrisponde alla combinazione di hash e siblings";
</script>
    <script type="text/javascript">
function checkRequiredLibrariesAreLoaded(){var e="undefined"!=typeof CryptoJS&&void 0!==CryptoJS.lib.Cipher&&void 0!==CryptoJS.SHA256&&void 0!==CryptoJS.format.Hex,t="undefined"!=typeof PDFJS&&!$.isEmptyObject(PDFJS);e&&t||($("#libraries-not-loaded-error-msg").text(allRequestLibrariesAreNotLoadedMsg),$("#libraries-not-loaded-error").removeClass("hidden"),$(".content").addClass("disabled"),$("label.blue-button").addClass("disabled"),$("#upload_report_pdf").attr("disabled",!0))}function setVerificationResultMsg(){$("#verifyhashresult .verification-success span").text(hashValidMsg),$("#verifyhashresult .verification-error span").text(hashNotValidMsg),$("#verifymerkleresult .verification-success span").text(merkleValidMsg),$("#verifymerkleresult .verification-error span").text(merkleNotValidMsg)}function showVerificationResult(t,r){setTimeout(function(){var e=$("#"+r).removeClass("hidden");t?($(".verification-success",e).removeClass("hidden"),$(".verification-error",e).addClass("hidden")):($(".verification-success",e).addClass("hidden"),$(".verification-error",e).removeClass("hidden"))},200)}function interpolateString(e,t){for(key in t){var r="${"+key+"}";-1!=e.indexOf(r)&&(e=e.replace(r,t[key]))}return e}function veryfyAll(){verifyHash(),verifyMerkle(),verifyBC()}function verifyBC(){$("#verifybcresult").addClass("hidden");CheckCert.verifyBC(function(e){e.success?$("#verifybcresult  .verification-success span").text(interpolateString(blockchainValidMsg,{txId:e.txId,env:e.env})):0===e.errorCode?$("#notarization-error-msg").text(interpolateString(transactionIdErrorMsg,{txId:e.txId,env:e.env})):1===e.errorCode?$("#notarization-error-msg").text(interpolateString(merkleRootErrorMsg,{txId:e.txId,env:e.env})):2===e.errorCode?$("#notarization-error-msg").text(interpolateString(blocktimeErrorMsg,{txId:e.txId,env:e.env})):3===e.errorCode?$("#notarization-error-msg").text(interpolateString(confirmationsErrorMsg,{txId:e.txId,env:e.env})):4===e.errorCode?$("#notarization-error-msg").text(interpolateString(dataInsertedErrorMsg,{txId:e.txId,env:e.env})):5===e.errorCode?$("#notarization-error-msg").text(interpolateString(environmentErrorMsg,{env:e.env})):$("#notarization-error-msg").text(dataFormattedErrorMsg),showVerificationResult(e.success,"verifybcresult")},function(e){400<=e&&e<500?$("#notarization-error-msg").text(interpolateString(requestDataNotValidMsg,{code:e})):500<=e&&e<600&&$("#notarization-error-msg").text(connectionErrorMsg),showVerificationResult(!1,"verifybcresult")})}function verifyHash(){$("#verifyhashresult").addClass("hidden");CheckCert.verifyHash(function(e){showVerificationResult(e,"verifyhashresult")})}function verifyMerkle(){$("#verifymerkleresult").addClass("hidden");CheckCert.verifyMerkle(function(e){showVerificationResult(e,"verifymerkleresult")})}function restoreAll(){restorePayload(),restoreMerkle(),restoreSiblings(),restoreNotarization()}function restoreNotarization(){CheckCert.restoreData("notarization")}function restorePayload(){CheckCert.restoreData("payload")}function restoreMerkle(){CheckCert.restoreData("merkle")}function restoreSiblings(){CheckCert.restoreData("siblings_1"),CheckCert.restoreData("siblings_2")}function resizeTextareas(){$("textarea").each(function(e){$(this).height($(this)[0].scrollHeight)})}function getPdfCanvasSize(){var e=$("#pdfContainer").height(),t=$("#pdfContainer").width(),r=parseInt($("#pdfContainer").css("paddingLeft"))+parseInt($("#pdfContainer").css("paddingRight")),i=e-(parseInt($("#pdfContainer").css("paddingTop"))+parseInt($("#pdfContainer").css("paddingBottom")))-$("#pdf_name").height()-(parseInt($("#pdf_name").css("marginTop"))+parseInt($("#pdf_name").css("marginBottom"))),a=210*i/297;return t-r<a&&(i=297*(a=t-r)/210),{width:a,height:i}}"undefined"==typeof jQuery?(document.getElementById("libraries-not-loaded-error-msg").textContent=allRequestLibrariesAreNotLoadedMsg,document.getElementById("libraries-not-loaded-error").classList.remove("hidden"),document.getElementsByClassName("content")[0].classList.add("disabled"),document.querySelectorAll("label.blue-button")[0].classList.add("disabled"),document.getElementById("upload_report_pdf").disabled=!0):$(function(){checkRequiredLibrariesAreLoaded(),setVerificationResultMsg(),$(window).on("resize",function(){var e=getPdfCanvasSize().height,t=getPdfCanvasSize().width;CheckCert.showDocument(1,"canvas",t,e)})}),CheckCert.loadDocument("upload_report_pdf",function(e){if("PDFStructureNotValidFault"!==e){var t=getPdfCanvasSize().height,r=getPdfCanvasSize().width;$("#pdfContainer .pdf_load").removeClass("hidden"),$("#pdfContainer .pdf_not_upload").addClass("hidden"),CheckCert.showDocument(1,"canvas",r,t),CheckCert.extractData(1,"payload","notarization","merkle","siblings_1","siblings_2",resizeTextareas),$("button:disabled").removeAttr("disabled"),$("#pdf_name").text(CheckCert.getPDFName()),$("textarea").attr("readonly",!1)}else $("#pdfContainer .pdf_load").addClass("hidden"),$("#pdfContainer .pdf_not_upload").removeClass("hidden"),$("#pdfContainer .pdf_not_upload").addClass("error"),$("#pdfContainer .pdf_not_upload").text("Il file non ha una struttura PDF interpretabile"),CheckCert.resetAllData("payload","notarization","merkle","siblings_1","siblings_2"),$(".right-container button").attr("disabled",!0),$("textarea").attr("readonly",!0);$(".verification-result").addClass("hidden")},function(e){$("#pdfContainer .pdf_load").addClass("hidden"),$("#pdfContainer .pdf_not_upload").removeClass("hidden"),$("#pdfContainer .pdf_not_upload").addClass("error"),$("#pdfContainer .pdf_not_upload").text("Il file non ha una struttura PDF interpretabile"),CheckCert.resetAllData("payload","notarization","merkle","siblings_1","siblings_2"),$(".right-container button").attr("disabled",!0),$(".verification-result").addClass("hidden"),$("textarea").attr("readonly",!0)});
